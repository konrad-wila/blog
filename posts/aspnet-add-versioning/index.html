<!DOCTYPE html>
<html lang="en" data-theme="">
<head>
    
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name = "apple-mobile-web-app-capable" content = "yes">
    <meta name="theme-color" content="#121212">

    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <title>ASP.NET Core Add Versioning - ELL Blog</title>
    <meta name="description" content="Introduction

    
        
    

This tutorial will save you 5 hours. I don&rsquo;t know when I started adding API version support to my ASP.NET project, but I can tell you that the current documentation is atrocious if you strive for perfection like I do.">
    
    <link rel="icon" type="image/x-icon" href="https://blog.elijahlopez.ca/favicon.ico">
    <link rel="apple-touch-icon-precomposed" href="https://blog.elijahlopez.ca/favicon.png">

    <link rel="stylesheet" href="https://blog.elijahlopez.ca/css/style.min.aaf2c7fda9310c97167f1a94f41891944861efa73f96c5467dbea9ecc5ddb751.css" integrity="sha256-qvLH/akxDJcWfxqU9BiRlEhh76c/lsVGfb6p7MXdt1E=">
    <script src="https://blog.elijahlopez.ca/js/script.min.74bf1a3fcf1af396efa4acf3e660e876b61a2153ab9cbe1893ac24ea6d4f94ee.js" type="text/javascript" charset="utf-8" integrity="sha256-dL8aP88a85bvpKzz5mDodrYaIVOrnL4Yk6wk6m1PlO4="></script>
    <meta property="og:url" content="https://blog.elijahlopez.ca/posts/aspnet-add-versioning/">
  <meta property="og:site_name" content="ELL Blog">
  <meta property="og:title" content="ASP.NET Core Add Versioning">
  <meta property="og:description" content="Introduction This tutorial will save you 5 hours. I don’t know when I started adding API version support to my ASP.NET project, but I can tell you that the current documentation is atrocious if you strive for perfection like I do.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-07T02:05:53-05:00">
    <meta property="article:modified_time" content="2024-03-07T02:05:53-05:00">
    <meta property="article:tag" content="Programming">
    <meta property="article:tag" content="Tutorial">
    <meta property="article:tag" content="C-Sharp">
    <meta property="article:tag" content="Asp.net">
    <meta property="og:image" content="https://blog.elijahlopez.ca/images">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://blog.elijahlopez.ca/images">
  <meta name="twitter:title" content="ASP.NET Core Add Versioning">
  <meta name="twitter:description" content="Introduction This tutorial will save you 5 hours. I don’t know when I started adding API version support to my ASP.NET project, but I can tell you that the current documentation is atrocious if you strive for perfection like I do.">






    





</head>

<body>
    <a class="skip-main" href="#main">Skip to main content</a>
    <div class="container">
        <header class="common-header">
            
                

    


<div class="header-top">
    <h1 class="site-title">
        <a href="/">ELL Blog</a>
    </h1>

    <div class="header-top-left">
    <ul class="social-icons">

        <li>
            <a href="/index.xml" title="Rss" rel="me">
                <span class="inline-svg" >
                    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-icon="rss" data-prefix="fas" focusable="false" role="img" viewBox="0 0 496 512"><path fill="currentColor" fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg>
                </span>

            </a>
        </li>
    

        <li>
            <a href="https://elijahlopez.ca" title="Website" rel="me">
                <span class="inline-svg" >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M352 256C352 278.2 350.8 299.6 348.7 320H163.3C161.2 299.6 159.1 278.2 159.1 256C159.1 233.8 161.2 212.4 163.3 192H348.7C350.8 212.4 352 233.8 352 256zM503.9 192C509.2 212.5 512 233.9 512 256C512 278.1 509.2 299.5 503.9 320H380.8C382.9 299.4 384 277.1 384 256C384 234 382.9 212.6 380.8 192H503.9zM493.4 160H376.7C366.7 96.14 346.9 42.62 321.4 8.442C399.8 29.09 463.4 85.94 493.4 160zM344.3 160H167.7C173.8 123.6 183.2 91.38 194.7 65.35C205.2 41.74 216.9 24.61 228.2 13.81C239.4 3.178 248.7 0 256 0C263.3 0 272.6 3.178 283.8 13.81C295.1 24.61 306.8 41.74 317.3 65.35C328.8 91.38 338.2 123.6 344.3 160H344.3zM18.61 160C48.59 85.94 112.2 29.09 190.6 8.442C165.1 42.62 145.3 96.14 135.3 160H18.61zM131.2 192C129.1 212.6 127.1 234 127.1 256C127.1 277.1 129.1 299.4 131.2 320H8.065C2.8 299.5 0 278.1 0 256C0 233.9 2.8 212.5 8.065 192H131.2zM194.7 446.6C183.2 420.6 173.8 388.4 167.7 352H344.3C338.2 388.4 328.8 420.6 317.3 446.6C306.8 470.3 295.1 487.4 283.8 498.2C272.6 508.8 263.3 512 255.1 512C248.7 512 239.4 508.8 228.2 498.2C216.9 487.4 205.2 470.3 194.7 446.6H194.7zM190.6 503.6C112.2 482.9 48.59 426.1 18.61 352H135.3C145.3 415.9 165.1 469.4 190.6 503.6V503.6zM321.4 503.6C346.9 469.4 366.7 415.9 376.7 352H493.4C463.4 426.1 399.8 482.9 321.4 503.6V503.6z"/></svg>
                </span>

            </a>
        </li>
    

        
        
        <li>
            <a href="https://github.com/elibroftw" title="Github" rel="me">
            <span class="inline-svg" >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
                </span>

            </a>
        </li>
    

        
        
        <li>
            <a href="https://twitter.com/elibroftw" title="Twitter" rel="me">
            <span class="inline-svg" >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
                </span>

            </a>
        </li>
    

        
        
        <li>
            <a href="https://www.youtube.com/c/elibroftw" title="Youtube" rel="me">
            <span class="inline-svg" >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
                </span>

            </a>
        </li>
    

        
        
        <li>
            <a href="mailto:elijahllopezz@gmail.com" title="Email" rel="me">
            <span class="inline-svg" >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg>
                </span>

            </a>
        </li>
    

        
        
        <li>
            <a href="https://www.instagram.com/elijahllopezz" title="Instagram" rel="me">
            <span class="inline-svg" >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
                </span>

            </a>
        </li>
    



</ul>
</div>
    

    




    <div class="header-top-right theme-switcher">
        <span class="inline-svg" >
                    <svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 290 290">
<path fill="currentColor" d="M142.959,0C64.131,0,0,64.132,0,142.96c0,78.828,64.131,142.959,142.959,142.959c78.828,0,142.96-64.131,142.96-142.959  C285.919,64.132,221.787,0,142.959,0z M142.959,260.919V142.96V25c65.043,0,117.96,52.917,117.96,117.96  C260.919,208.003,208.002,260.919,142.959,260.919z"/>
</svg>
                </span>

    </div>


<script>
const STORAGE_KEY = 'user-color-scheme'
const defaultTheme = "auto"

let currentTheme
let switchButton
let autoDefinedScheme = window.matchMedia('(prefers-color-scheme: dark)')

const autoChangeScheme = e => {
    currentTheme = e.matches ? 'dark' : 'light'
    document.documentElement.setAttribute('data-theme', currentTheme)
}

document.addEventListener('DOMContentLoaded', function() {
    switchButton = document.querySelector('.theme-switcher')
    currentTheme = detectCurrentScheme()
    setThemeColorMeta(currentTheme)
    if (currentTheme == 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark')
    }

    if (currentTheme == 'auto') {
        autoChangeScheme(autoDefinedScheme);
        autoDefinedScheme.addListener(autoChangeScheme);
    }

    if (switchButton) {
        switchButton.addEventListener('click', switchTheme, false)
    }
})

function detectCurrentScheme() {
    if (localStorage !== null && localStorage.getItem(STORAGE_KEY)) {
        return localStorage.getItem(STORAGE_KEY)
    }
    if (defaultTheme) {
        return defaultTheme
    }
    if (!window.matchMedia) {
        return defaultTheme
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return 'dark'
    }
    return defaultTheme
}

function switchTheme(e) {
    if (currentTheme == 'dark') {
        if (localStorage !== null)
            localStorage.setItem(STORAGE_KEY, 'light')
        document.documentElement.setAttribute('data-theme', 'light')
        currentTheme = 'light'
    } else {
        if (localStorage !== null)
            localStorage.setItem(STORAGE_KEY, 'dark')
        document.documentElement.setAttribute('data-theme', 'dark')
        currentTheme = 'dark'
    }
    setThemeColorMeta(currentTheme)
}

function setThemeColorMeta(currentTheme) {
    if (currentTheme == 'dark') {
        document.querySelector('meta[name="theme-color"]').setAttribute('content', '#121212')
    } else {
        document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
    }
}
</script>

</div>


    <nav>
        
        
        <a class="" href="https://blog.elijahlopez.ca/" title="Home">Home</a>
        
        <a class="" href="https://blog.elijahlopez.ca/posts/" title="Archive">Archive</a>
        
        <a class="" href="https://blog.elijahlopez.ca/tags/" title="Tags">Tags</a>
        
    </nav>






            
        </header>
        <main id="main" tabindex="-1">
            
    

    <article class="post h-entry">
        <div class="post-header">
            <header>
                <h1 class="p-name post-title">ASP.NET Core Add Versioning</h1>

                
            </header>
        </div>
        




        <div class="content e-content">
            <h3 id="introduction" >Introduction
<span>
    <a href="#introduction">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h3><p>This tutorial will save you 5 hours. I don&rsquo;t know when I started adding API version support to my ASP.NET project, but I can tell you that the current documentation is atrocious if you strive for perfection like I do.</p>
<p>As our mobile application is about to have an official MVP release, I wanted to fix the Stripe payment intent method &ldquo;invoice.&rdquo; Currently, the invoice method would only return the client secret, but the official docs suggest to return the customer ID and a ephemeral key in addition to the payment intent client secret. I had two options. Either break current builds in use because you know its only beta testing anyways, or I can use this as an opportunity to add API versioning. There&rsquo;s two main ways to do API versioning in my eyes. The first way, which is what I thought I would&rsquo;ve added in the future, is to be one of those companies with apis like <code>/v2/my-api</code> but then I found out about header APIs where the client can just add a header. This saves a lot of time because first of all, most of my apis were <code>/api</code> not <code>/v1/api</code> and the client was already calling without a version. I want an easy way to just switch the default version to <code>v2</code> so I went with reading the API version from the header.</p>
<p>After hours of consulting Gemini, the official docs, and examples, and personal touches, I present the absolutely bare minimum way to add versioning to your ASP.NET application.</p>
<h3 id="nuget-packages" >NuGet Packages
<span>
    <a href="#nuget-packages">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h3><p>Either go to Manage Nuget Packages or use the CLI to install <code>Asp.Versioning.Mvc.ApiExplorer</code></p>
<p><code>nuget install Asp.Versioning.Mvc.ApiExplorer</code></p>
<h3 id="programcs" >Program.cs
<span>
    <a href="#programcs">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h3><p>Note that by default, ASP.NET will set each route as version 1 unless otherwise defined. Also note that if a client does not specify a version, the version 1 route will be used by default.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span>builder.Services.AddApiVersioning(options =&gt; {
</span></span><span style="display:flex;"><span>    options.DefaultApiVersion = <span style="color:#6ab825;font-weight:bold">new</span> ApiVersion(<span style="color:#3677a9">1</span>, <span style="color:#3677a9">0</span>);
</span></span><span style="display:flex;"><span>    options.AssumeDefaultVersionWhenUnspecified = <span style="color:#6ab825;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    options.ApiVersionReader = <span style="color:#6ab825;font-weight:bold">new</span> HeaderApiVersionReader(<span style="color:#ed9d13">&#34;x-ms-version&#34;</span>);
</span></span><span style="display:flex;"><span>    options.ReportApiVersions = <span style="color:#6ab825;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    options.UnsupportedApiVersionStatusCode = <span style="color:#3677a9">501</span>;
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// format the version as &#34;&#39;v&#39;major[.minor][-status]&#34;</span>
</span></span><span style="display:flex;"><span>.AddApiExplorer(options =&gt; {
</span></span><span style="display:flex;"><span>    options.GroupNameFormat = <span style="color:#ed9d13">&#34;&#39;v&#39;VVV&#34;</span>;
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h3 id="programauxiliarycs" >ProgramAuxiliary.cs
<span>
    <a href="#programauxiliarycs">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h3><p>The following code allows the Swagger UI to work with the versioning.</p>
<p>Some of this code might be unused, this is because in my own <code>ProgramAuxiliary.cs</code>, I also have the code to enable <a href="/posts/aspnet-kebab-case-routes/">kebab case routes</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#999;font-style:italic">// ProgramAuxiliary.cs is a supplementary to the startup code in Program.cs where this file contains some boilerplate to provide abstraction</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">Asp.Versioning.ApiExplorer</span>;
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">Microsoft.AspNetCore.Mvc.ApiExplorer</span>;
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">Microsoft.AspNetCore.Mvc.ModelBinding</span>;
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">Microsoft.Extensions.Options</span>;
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">Microsoft.OpenApi.Models</span>;
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">Swashbuckle.AspNetCore.SwaggerGen</span>;
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System.Text.Json</span>;
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System.Text.RegularExpressions</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">namespace</span> <span style="color:#447fcf;text-decoration:underline">SttApi</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// all I know is that this is related to making swagger work with different versions of the API</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">ConfigureSwaggerOptions</span>(IApiVersionDescriptionProvider provider) : IConfigureOptions&lt;SwaggerGenOptions&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">readonly</span> IApiVersionDescriptionProvider _provider = provider;
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">readonly</span> <span style="color:#6ab825;font-weight:bold">string</span> _apiName = <span style="color:#ed9d13">&#34;Split The Tank&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> Configure(SwaggerGenOptions options) {
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">foreach</span> (<span style="color:#6ab825;font-weight:bold">var</span> description <span style="color:#6ab825;font-weight:bold">in</span> _provider.ApiVersionDescriptions) {
</span></span><span style="display:flex;"><span>            options.SwaggerDoc(
</span></span><span style="display:flex;"><span>              description.GroupName,
</span></span><span style="display:flex;"><span>                <span style="color:#6ab825;font-weight:bold">new</span> OpenApiInfo() {
</span></span><span style="display:flex;"><span>                    Title = <span style="color:#ed9d13">$&#34;{_apiName} API {description.ApiVersion}&#34;</span>,
</span></span><span style="display:flex;"><span>                    Version = description.ApiVersion.ToString(),
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// All I know is that this bunch of code is related to making sure the API version is set in the header by default</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">SwaggerDefaultValues</span> : IOperationFilter {
</span></span><span style="display:flex;"><span>    <span style="color:#e50808;background-color:#520000;font-weight:bold">/// &lt;inheritdoc /&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> Apply(OpenApiOperation operation, OperationFilterContext context) {
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">var</span> apiDescription = context.ApiDescription;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        operation.Deprecated |= apiDescription.IsDeprecated();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic">// REF: https://github.com/domaindrivendev/Swashbuckle.AspNetCore/issues/1752#issue-663991077</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">foreach</span> (<span style="color:#6ab825;font-weight:bold">var</span> responseType <span style="color:#6ab825;font-weight:bold">in</span> context.ApiDescription.SupportedResponseTypes) {
</span></span><span style="display:flex;"><span>            <span style="color:#999;font-style:italic">// REF: https://github.com/domaindrivendev/Swashbuckle.AspNetCore/blob/b7cf75e7905050305b115dd96640ddd6e74c7ac9/src/Swashbuckle.AspNetCore.SwaggerGen/SwaggerGenerator/SwaggerGenerator.cs#L383-L387</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">var</span> responseKey = responseType.IsDefaultResponse ? <span style="color:#ed9d13">&#34;default&#34;</span> : responseType.StatusCode.ToString();
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">var</span> response = operation.Responses[responseKey];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">foreach</span> (<span style="color:#6ab825;font-weight:bold">var</span> contentType <span style="color:#6ab825;font-weight:bold">in</span> response.Content.Keys) {
</span></span><span style="display:flex;"><span>                <span style="color:#6ab825;font-weight:bold">if</span> (!responseType.ApiResponseFormats.Any(x =&gt; x.MediaType == contentType)) {
</span></span><span style="display:flex;"><span>                    response.Content.Remove(contentType);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">if</span> (operation.Parameters == <span style="color:#6ab825;font-weight:bold">null</span>) <span style="color:#6ab825;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic">// REF: https://github.com/domaindrivendev/Swashbuckle.AspNetCore/issues/412</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic">// REF: https://github.com/domaindrivendev/Swashbuckle.AspNetCore/pull/413</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">foreach</span> (<span style="color:#6ab825;font-weight:bold">var</span> parameter <span style="color:#6ab825;font-weight:bold">in</span> operation.Parameters) {
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">var</span> description = apiDescription.ParameterDescriptions.First(p =&gt; p.Name == parameter.Name);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            parameter.Description ??= description.ModelMetadata?.Description;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">if</span> (parameter.Schema.Default == <span style="color:#6ab825;font-weight:bold">null</span> &amp;&amp; description.DefaultValue != <span style="color:#6ab825;font-weight:bold">null</span> &amp;&amp;
</span></span><span style="display:flex;"><span>                 description.DefaultValue <span style="color:#6ab825;font-weight:bold">is</span> not DBNull &amp;&amp; description.ModelMetadata <span style="color:#6ab825;font-weight:bold">is</span> ModelMetadata modelMetadata) {
</span></span><span style="display:flex;"><span>                <span style="color:#999;font-style:italic">// REF: https://github.com/Microsoft/aspnet-api-versioning/issues/429#issuecomment-605402330</span>
</span></span><span style="display:flex;"><span>                <span style="color:#6ab825;font-weight:bold">var</span> json = JsonSerializer.Serialize(description.DefaultValue, modelMetadata.ModelType);
</span></span><span style="display:flex;"><span>                parameter.Schema.Default = OpenApiAnyFactory.CreateFromJson(json);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            parameter.Required |= description.IsRequired;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="controller-sample" >Controller Sample
<span>
    <a href="#controller-sample">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h3><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#bbb">[Route(&#34;[controller]</span>/[action]<span style="color:#ed9d13">&#34;)]
</span></span></span><span style="display:flex;"><span><span style="color:#ed9d13"></span><span style="color:#bbb">[ApiController]</span>
</span></span><span style="display:flex;"><span><span style="color:#bbb">[Authorize]</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// since we are defining a version 2, we want to inform ASP.NET that the other routes are version 1, you can experiment without this at first just to see the result</span>
</span></span><span style="display:flex;"><span><span style="color:#bbb">[ApiVersion(1.0)]</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">PaymentController</span> : ControllerBase {
</span></span><span style="display:flex;"><span>  <span style="color:#999;font-style:italic">// this is Version 1</span>
</span></span><span style="display:flex;"><span><span style="color:#bbb">  [HttpGet]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">async</span> Task&lt;ActionResult&lt;<span style="color:#6ab825;font-weight:bold">string</span>&gt;&gt; Invoice(<span style="color:#6ab825;font-weight:bold">string</span> payee) {
</span></span><span style="display:flex;"><span>      <span style="color:#999;font-style:italic">// implementation omitted</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  [HttpGet]</span>
</span></span><span style="display:flex;"><span><span style="color:#bbb">  [ApiVersion(2.0)]</span>
</span></span><span style="display:flex;"><span><span style="color:#bbb">  [ActionName(nameof(Invoice))]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">async</span> Task&lt;ActionResult&lt;PaymentSheetProps&gt;&gt; InvoiceV2(<span style="color:#6ab825;font-weight:bold">string</span> payee) {
</span></span><span style="display:flex;"><span>      <span style="color:#999;font-style:italic">// implementation omitted</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#999;font-style:italic">// gate-keep entire API to reduce possibility of unofficial clients</span>
</span></span><span style="display:flex;"><span><span style="color:#bbb">[Route(&#34;[controller]</span>/[action]<span style="color:#ed9d13">&#34;)]
</span></span></span><span style="display:flex;"><span><span style="color:#ed9d13"></span><span style="color:#bbb">[ApiController]</span>
</span></span><span style="display:flex;"><span><span style="color:#bbb">[Authorize]</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">CarsController</span> : Controller {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">private</span> <span style="color:#6ab825;font-weight:bold">readonly</span> CarService _carService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">public</span> CarsController(CarService carService) {
</span></span><span style="display:flex;"><span>        _carService = carService;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-style:italic">// this is implicitly Version 1</span>
</span></span><span style="display:flex;"><span><span style="color:#bbb">    [HttpGet]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">async</span> Task&lt;List&lt;OwnedCar&gt;&gt; Owned() {
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">var</span> cars = <span style="color:#6ab825;font-weight:bold">await</span> _carService.GetOwned(User.FindFirstValue(ClaimTypes.Email)!);
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">return</span> cars!;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="client-sample" >Client Sample
<span>
    <a href="#client-sample">
        <svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
    </a>
</span>
</h3><p>In the future, I will provide samples in Kotlin and Swift as well. For now, here&rsquo;s a JS implementation. Just use an LLM to get code for the language of the client you are writing.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#999;font-style:italic">// note that jwtFetch is just a wrapper around fetch that does auto logging out and .json() conversion when application
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">export</span> <span style="color:#6ab825;font-weight:bold">async</span> <span style="color:#6ab825;font-weight:bold">function</span> paymentInvoice(jwt, logout, payee) {
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">const</span> response = <span style="color:#6ab825;font-weight:bold">await</span> jwtFetch(<span style="color:#ed9d13">`payment/invoice?payee=</span><span style="color:#ed9d13">${</span>payee<span style="color:#ed9d13">}</span><span style="color:#ed9d13">`</span>, logout, {
</span></span><span style="display:flex;"><span>    method: <span style="color:#ed9d13">&#39;GET&#39;</span>,
</span></span><span style="display:flex;"><span>    headers: { ...buildAuthHeader(jwt), <span style="color:#ed9d13">&#39;x-ms-version&#39;</span>: <span style="color:#ed9d13">&#39;2.0&#39;</span> },
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#6ab825;font-weight:bold">return</span> response;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
        </div>
        <div class="post-info">
    
        <div class="post-date dt-published">
            <a class="u-url" href="/posts/aspnet-add-versioning/"><time datetime="2024-03-07">March 7, 2024</time></a>
            
        </div>
    
    <a class="post-hidden-url u-url" href="https://blog.elijahlopez.ca/posts/aspnet-add-versioning/">https://blog.elijahlopez.ca/posts/aspnet-add-versioning/</a>
    <a href="https://blog.elijahlopez.ca/" class="p-name p-author post-hidden-author h-card" rel="me">Elijah Lopez</a>
    <div class="post-taxonomies">
        
        
            <ul class="post-tags">
                
                    
                    <li><a href="https://blog.elijahlopez.ca/tags/programming/">#Programming</a></li>
                
                    
                    <li><a href="https://blog.elijahlopez.ca/tags/tutorial/">#Tutorial</a></li>
                
                    
                    <li><a href="https://blog.elijahlopez.ca/tags/c-sharp/">#C-Sharp</a></li>
                
                    
                    <li><a href="https://blog.elijahlopez.ca/tags/asp.net/">#Asp.net</a></li>
                
            </ul>
        
        
    </div>
</div>

    </article>

    

    
        
    
    
    <div class="pagination post-pagination">
        <div class="left pagination-item ">
            
                <a title="Israel&rsquo;s Government is Anti-Peace and Anti-Palestine" href="/posts/israel-is-against-peace/">Israel&rsquo;s Government is Anti-Peace and Anti-Palestine</a>
            
        </div>
        <div class="right pagination-item ">
            
                <a title="Retail Investors Are Stupid" href="/posts/retail-investors-are-stupid/">Retail Investors Are Stupid</a>
            
        </div>
    </div>




    

    
        <br>









    





<script src="https://giscus.app/client.js"
        data-repo="elibroftw/blog.elijahlopez.ca"
        data-repo-id="R_kgDOGiL7hg"
        data-category="General"
        data-category-id="DIC_kwDOGiL7hs4Cer6e"
        data-mapping="og:title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        
        async>
</script>

    

        </main>
        
            <footer class="common-footer">
    
    

    <div class="common-footer-bottom">
        
        <div class="copyright">
            <p>© Elijah Lopez, 2024<br>
            Powered by <a target="_blank" rel="noopener noreferrer" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" rel="noopener noreferrer" href="https://github.com/elibroftw/hugo-theme-anubis">Anubis</a>.<br>
            
            </p>
        </div>
    </div>

    <p class="h-card vcard">

    <a href=https://blog.elijahlopez.ca/ class="p-name u-url url fn" rel="me">Elijah Lopez</a> 

     
        /
        <a class="p-email u-email email" rel="me" href="mailto:elijahllopezz@gmail.com">elijahllopezz@gmail.com</a>
    

     
        <img class="u-photo" src="https://pbs.twimg.com/profile_images/1738729591064166400/vqarzcF7_400x400.jpg" />
    
</p> 
</footer>

        
    </div>
</body>
</html>
